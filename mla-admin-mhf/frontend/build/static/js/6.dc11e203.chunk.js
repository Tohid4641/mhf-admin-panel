(this.webpackJsonpmla=this.webpackJsonpmla||[]).push([[6],{1105:function(e,a,t){},1121:function(e,a,t){"use strict";t.r(a);var l=t(8),n=t(19),i=t(12),s=t(13),r=t(7),o=t(16),c=t(15),u=t(0),m=t.n(u),d=t(87),p=t.n(d),f=(t(1105),t(823)),v=t(824),g=t(825),h=t(826),b=t(827),E=t(828),y=t(822),N=t(3),S=t.n(N),x=t(27),O=(t(164),t(51)),w=t.n(O),F=t(20),C=t.n(F),j=t(11),A=t(53),V=t(94),k=t(134),U=t(18),D=t.n(U),I=function(e){Object(o.a)(t,e);var a=Object(c.a)(t);function t(e){var s;Object(i.a)(this,t),(s=a.call(this,e)).addVideoDumyyItem=function(){var e=s.state,a=e.inputs,t=e.options;a.push({type:t[0],value:""}),s.setState({inputs:a})},s.removeInputs=function(e){s.state.inputs.splice(e,1),s.setState({inputs:s.state.inputs})},s.updateValidators=function(e,a){s.validators[e].errors=[],s.validators[e].state=a,s.validators[e].valid=!0,s.validators[e].rules.forEach((function(t){t.test instanceof RegExp?t.test.test(a)||(s.validators[e].errors.push(t.message),s.validators[e].valid=!1):"function"===typeof t.test&&(t.test(a)||(s.validators[e].errors.push(t.message),s.validators[e].valid=!1))}))},s.isFormValid=function(){var e=!0;return Object.keys(s.validators).forEach((function(a){"album_title"===a&&(s.validators[a].valid||(e=!1))})),e},s.displayValidationErrors=function(e){var a=s.validators[e];if(a&&!a.valid){var t=a.errors.map((function(e,a){return m.a.createElement("span",{className:"error",key:a},"* ",e,m.a.createElement("br",null))}));return m.a.createElement("div",{className:"col s12 row"},t)}return""},s.onChangeFileHandler=function(e){s.setState(Object(n.a)({},e.target.name,e.target.files));var a=Object(r.a)(s),t=Array.from(e.target.files);a.setState({newfiles:t})},s.handleChange=function(e){s.setState({startDate:e})},s.addAlbum=function(e){var a=s.state.album_title,t=Object(r.a)(s);s.setState({authenticating:!0}),S.a.all([j.a.insertAlbum(a,e)]).then((function(e){if(e[0]){var a=e[0].data;a.status?t.props.history.push("/albums"):t.setState({apiError:a.msg})}t.setState({authenticating:!1})})).catch((function(e){console.log(e),e.message&&console.log("An error occurred in change Password")}))},s.getAlbumDetails=function(e){var a=Object(r.a)(s);S.a.all([j.a.getAlbum(e)]).then((function(e){if(e[0]){var t=e[0].data;if(t.status){var l,n=t.data,i=n.albumFiles?n.albumFiles.replace(/quot;/g,'"'):"";if(l={id:n._id,albumTitle:n.albumTitle,albumFiles:JSON.parse(i),albumDate:n.createdAt},console.log(l),l.albumFiles){if(l.albumFiles&&l.albumFiles.images){var s=l.albumFiles.images;a.setState({albumFileNames:s})}if(l.albumFiles&&l.albumFiles.videos){var r=l.albumFiles.videos;a.setState({albumVideoFileNames:r})}}var o=l.albumTitle,c=l.albumFiles,u={album_title:o};Object.keys(u).map((function(e){return a.updateValidators([e],u[e]),!0})),a.setState({album_title:o,fileName:c}),a.setState({albumDetails:l}),a.setState({Success_msg:""})}else a.setState({apiError:t})}})).catch((function(e){console.log(e),e.message&&console.log("An error occurred in change Password")}))},s.updateAlbum=function(e){var a=s.state.album_title,t=Object(r.a)(s),l=s.props.match.params.album_id;s.setState({authenticating:!0}),S.a.all([j.a.updateAlbum(a,e,l)]).then((function(e){if(e[0]){var a=e[0].data;a.status?t.props.history.push("/albums/"+l):t.setState({apiError:a.msg})}t.setState({authenticating:!1})})).catch((function(e){console.log(e),e.message&&console.log("An error occurred in change Password")}))},s.numberoffile=function(){var e=s.state.newfiles;return 0===e.length?null:m.a.createElement("p",{style:{marginBottom:"0rem",paddingLeft:"4px",display:"inline-block"}},"file(",e.length,")")},s.changeHandler=function(e){s.setState({language:e}),p.a.save("language",e,{path:"/"})},s.renderUsers=function(e,a){return m.a.createElement(V.b,{key:a,draggableId:a+" ",index:a},(function(t){return m.a.createElement("div",Object.assign({ref:t.innerRef},t.draggableProps,t.dragHandleProps),m.a.createElement("div",{className:"item mx-auto"},m.a.createElement("div",null,m.a.createElement("img",{className:"imgefiles mx-auto",style:{width:"230px"},name:"file",onChange:s.onChangeFileHandler,src:s.props.config.s3BasicPath+e,alt:"avatar"})),m.a.createElement("div",{className:"transp-layer"}),m.a.createElement("i",{className:"fa fa-window-close asset-remove",onClick:function(){s.removeImage(e,a)}})))}))},s.removeImage=function(e,a){console.log(e,a);var t=s.state.albumFileNames;t.splice(a,1),s.setState({albumFileNames:t})},s.renderVideo=function(e,a){var t=e.split("||||");return m.a.createElement(V.b,{key:a,draggableId:a+" ",index:a},(function(l){return m.a.createElement("div",Object.assign({ref:l.innerRef},l.draggableProps,l.dragHandleProps),m.a.createElement("div",{className:"item mx-auto"},m.a.createElement("div",{key:a,className:"player-wrapper"},m.a.createElement("img",{className:"imgefiles mx-auto",style:{width:"230px"},name:"file",onChange:s.onChangeFileHandler,src:s.props.config.s3BasicPath+t[1],alt:"avatar"}),m.a.createElement("div",{className:"transp-layer"}),m.a.createElement("i",{className:"fa fa-window-close asset-remove",onClick:function(){s.removeVideo(e,a)}}))))}))},s.removeVideo=function(e,a){console.log(e,a);var t=s.state.albumVideoFileNames;t.splice(a,1),s.setState({albumVideoFileNames:t})},s.videoTypeChnage=function(e,a){var t=s.state.inputs;t=t.map((function(t,n){return a===n?Object(l.a)(Object(l.a)({},t),{},{type:e}):Object(l.a)({},t)})),s.setState({inputs:t})},s.onVideoInputChange=function(e,a,t){console.log(e.target.files);var n=s.state.inputs;n=n.map((function(n,i){if(a===i){if("preview"===t){var s=Array.from(e.target.files);return Object(l.a)(Object(l.a)({},n),{},{preview:s})}return Object(l.a)(Object(l.a)({},n),{},{value:"url"===t?e.target.value:e.target.files})}return Object(l.a)({},n)})),console.log(n),s.setState({inputs:n})},s.onDragEnd=function(e){var a=e.destination,t=e.source,l=e.reason;if(a&&"CANCEL"!==l&&(a.droppableId!==t.droppableId||a.index!==t.index)){var n=Object.assign([],s.state.albumFileNames),i=s.state.albumFileNames[t.index];n.splice(t.index,1),n.splice(a.index,0,i),s.setState({albumFileNames:n})}},s.onDragEndVideo=function(e){var a=e.destination,t=e.source,l=e.reason;if(a&&"CANCEL"!==l&&(a.droppableId!==t.droppableId||a.index!==t.index)){var n=Object.assign([],s.state.albumVideoFileNames),i=s.state.albumVideoFileNames[t.index];n.splice(t.index,1),n.splice(a.index,0,i),s.setState({albumVideoFileNames:n})}},s.onChange=s.onChange.bind(Object(r.a)(s)),s.handleSubmit=s.handleSubmit.bind(Object(r.a)(s)),s.fileUpload=s.fileUpload.bind(Object(r.a)(s));for(var o=[],c=1;c<7;c++)o.push({title:"rows".concat(c)});return s.state={album_title:"",apiError:"",file:"",fileUpload:"",newfiles:[],startDate:new Date,Date1:"",authenticating:!1,updateAlbum:!1,albumDetails:{},inputs:[],options:[{label:"upload video",value:2},{label:"Youtube url",value:1}],selectOptions:[{label:"upload video",value:2},{label:"Youtube url",value:1}],languageCodes:[],language:p.a.load("language")?p.a.load("language"):"en",question:p.a.load("question")?p.a.load("question"):""},s.validators=A.a,s}return Object(s.a)(t,[{key:"componentDidMount",value:function(){console.log(this.props),this.props.location.pathname.indexOf("update")>-1&&(this.setState({updateAlbum:!0}),this.getAlbumDetails(this.props.match.params.album_id))}},{key:"onChange",value:function(e){this.setState(Object(n.a)({},e.target.name,e.target.value)),this.updateValidators([e.target.name],e.target.value)}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({authenticating:!0}),this.files3Upload()}},{key:"fileUpload",value:function(){var e=this.state,a=e.file,t=e.albumFileNames,l=this;this.setState({authenticating:!0}),S.a.all([j.a.fileUpload(a)]).then((function(e){if(e){var a=e[0].data,n=[];a.map((function(e){return e.filename&&n.push(e.filename),!0})),t&&t.length>0&&t.map((function(e){return n.push(e)})),l.videoUpload(n)}})).catch((function(e){console.log(e),e.message&&console.log("An error occurred in file upload")}))}},{key:"files3Upload",value:function(){var e=this.state,a=e.file,t=e.albumFileNames,l=[];a&&a.length>0&&Object.keys(a).map((function(e,t){return l.push(a[e]),!0})),this.setState({authenticating:!0});var n=this;S.a.all(l.map((function(e){return j.a.s3Upload(e)}))).then((function(e){if(e){var a=[];e.map((function(e){var t=e.data;return t.fileName&&a.push(t.fileName),!0})),t&&t.length>0&&t.map((function(e){return a.push(e)})),n.videos3Upload(a)}})).catch((function(e){console.log(e),e.message&&console.log("An error occurred in file upload")}))}},{key:"videoUpload",value:function(e){var a=this.state,t=a.inputs,l=a.albumVideoFileNames,n=[],i=[],s=[],r=!0;if(t.map((function(e){return e.type&&1===e.type.value?e.value&&""!==e.value.trim()?i.push(e.value):r=!1:e.type&&2===e.type.value&&(e.value?Object.keys(e.value).map((function(a){return n.push(e.value[a]),!0})):r=!1),e.preview?s.push(e.preview[0]):r=!1,!0})),r){this.setState({videoUploadError:!1});var o=this;S.a.all([j.a.fileUpload(n),j.a.fileUpload(s)]).then((function(a){if(a){var n=a[0].data,s=a[1].data,r=[],c=0,u=0;t.map((function(e,a){return e.type&&1===e.type.value?(r.push(i[u]+"||||"+s[a].filename),u+=1):e.type&&2===e.type.value&&(r.push(n[c].filename+"||||"+s[a].filename),c++),!0})),l&&l.length>0&&l.map((function(e){return r.push(e)}));var m={images:e,videos:r};o.state.updateAlbum?o.updateAlbum(JSON.stringify(m)):o.addAlbum(JSON.stringify(m))}})).catch((function(e){console.log(e),e.message&&console.log("An error occurred in file upload")}))}else this.setState({videoUploadError:!0,authenticating:!1})}},{key:"videos3Upload",value:function(e){var a=this.state,t=a.inputs,l=a.albumVideoFileNames,n=[],i=[],s=[],r=!0;if(t.map((function(e,a){return e.type&&1===e.type.value?e.value&&""!==e.value.trim()?i.push(e.value):r=!1:e.type&&2===e.type.value&&(e.value?Object.keys(e.value).map((function(a){return n.push(e.value[a]),!0})):r=!1),e.preview?s.push(e.preview[0]):r=!1,!0})),r){this.setState({videoUploadError:!1});var o=n.concat(s),c=this;S.a.all(o.map((function(e){return j.a.s3Upload(e)}))).then((function(a){if(a){var s=[],r=[];a.map((function(e,a){var t=e.data;return n.length>=a+1?s.push({filename:t.fileName}):r.push({filename:t.fileName}),!0}));var o=[],u=0,m=0;t.map((function(e,a){return e.type&&1===e.type.value?(o.push(i[m]+"||||"+r[a].filename),m+=1):e.type&&2===e.type.value&&(o.push(s[u].filename+"||||"+r[a].filename),u++),!0})),l&&l.length>0&&l.map((function(e){return o.push(e),!0}));var d={images:e,videos:o};c.state.updateAlbum?c.updateAlbum(JSON.stringify(d)):c.addAlbum(JSON.stringify(d))}})).catch((function(e){console.log(e),e.message&&console.log("An error occurred in file upload")}))}else this.setState({videoUploadError:!0,authenticating:!1})}},{key:"render",value:function(){var e=this,a=this.state,t=a.authenticating,l=a.albumFileNames,n=a.albumVideoFileNames;return m.a.createElement("div",{className:"col-span-12 mla-album-form"},m.a.createElement("div",{className:"grid grid-cols-12 gap-6 mt-8"},m.a.createElement("div",{className:"col-span-12 lg:col-span-10"},m.a.createElement("div",{className:"box"},m.a.createElement("div",{className:"flex flex-col sm:flex-row items-center p-5 border-b border-gray-200"},m.a.createElement("h2",{className:"font-medium text-base mr-auto"},m.a.createElement(D.a,{content:"album form"}))),m.a.createElement(f.a,null,m.a.createElement(v.a,{md:12},m.a.createElement(g.a,{className:" card-statistics mb-5"},m.a.createElement(h.a,null,m.a.createElement(w.a,{onSubmit:this.handleSubmit},m.a.createElement(f.a,null,m.a.createElement(v.a,{md:12},m.a.createElement(b.a,null,m.a.createElement(E.a,null,m.a.createElement(D.a,{content:"title"})),m.a.createElement(C.a,{htmlFor:"drugName",type:"text",name:"album_title",className:"form-control",value:this.state.album_title,onChange:this.onChange,placeholder:" Title",autoFocus:!0}),this.displayValidationErrors("album_title")))),m.a.createElement(f.a,null,l&&l.length>0&&m.a.createElement(v.a,{md:6},m.a.createElement(D.a,{content:"images"}),m.a.createElement(V.a,{onDragEnd:this.onDragEnd},m.a.createElement("div",{className:"container images_list"},m.a.createElement("div",{className:"users"},m.a.createElement(V.c,{droppableId:"dp1"},(function(a){return m.a.createElement("div",Object.assign({ref:a.innerRef},a.droppableProps),l.map(e.renderUsers),a.placeholder)})))))),n&&n.length>0&&m.a.createElement(v.a,{md:6},m.a.createElement(D.a,{content:"videos"}),m.a.createElement(V.a,{onDragEnd:this.onDragEndVideo},m.a.createElement("div",{className:"container videos_list"},m.a.createElement("div",{className:"users"},m.a.createElement(V.c,{droppableId:"dp1"},(function(a){return m.a.createElement("div",Object.assign({ref:a.innerRef},a.droppableProps),n.map(e.renderVideo),a.placeholder)}))))))),m.a.createElement(f.a,null,m.a.createElement(v.a,{md:12},m.a.createElement(b.a,null,m.a.createElement(E.a,null," ",m.a.createElement(D.a,{content:"upload images"})),m.a.createElement("label",{for:"file-upload",style:{marginLeft:"5px"},className:"custom-file-upload"},m.a.createElement("i",{className:"text-info fa fa-cloud-upload"}),m.a.createElement(D.a,{content:"choose file"})),m.a.createElement("input",{type:"file",id:"file-upload",name:"file",accept:"image/*",onChange:this.onChangeFileHandler,multiple:!0}),this.numberoffile(),this.state.newfiles&&this.state.newfiles.map((function(e,a){return m.a.createElement("p",{style:{marginBottom:"0rem"}},e.name)}))))),m.a.createElement("hr",null),m.a.createElement(f.a,null,m.a.createElement(v.a,{md:6,className:"mt-2 mb-2"},m.a.createElement(D.a,{content:"upload videos"})),this.state.inputs&&0===this.state.inputs.length&&m.a.createElement(v.a,{md:6,className:"mt-2 mb-2"},m.a.createElement("i",{style:{fontSize:"15px"},className:"fa fa-plus circle-icon add-first-video",onClick:this.addVideoDumyyItem}))),this.state.inputs.map((function(a,t){return m.a.createElement("div",{key:t,className:"mt-3"},m.a.createElement(f.a,null,m.a.createElement(v.a,{md:3},m.a.createElement(b.a,null,m.a.createElement(E.a,null,m.a.createElement(D.a,{content:"select"})," "),m.a.createElement(k.a,{name:"",className:"selectbox ",onChange:function(a){e.videoTypeChnage(a,t)},options:e.state.options,isSearchable:!0,value:a.type,style:{border:"none !important"}}))),a.type&&m.a.createElement(v.a,{md:3},1===a.type.value?m.a.createElement(b.a,null,m.a.createElement(E.a,null,m.a.createElement(D.a,{content:"add url"})),m.a.createElement("input",{type:"text",name:"addCustomUrl"+t,className:"form-control video-url",value:a.value?a.value:"",onChange:function(a){e.onVideoInputChange(a,t,"url")},placeholder:"Add Url"})):m.a.createElement(b.a,null,m.a.createElement(E.a,null," ",m.a.createElement(D.a,{content:"upload videos"})),m.a.createElement("label",{for:"file-upload"+t,style:{marginLeft:"5px"},className:"custom-file-upload"},m.a.createElement("i",{className:"text-info fa fa-cloud-upload"}),a.value&&a.value.length>0?m.a.createElement("p",{className:"video-file"},a.value[0].name):m.a.createElement(D.a,{content:"choose file"})),m.a.createElement("input",{type:"file",id:"file-upload"+t,name:"file",accept:"video/*",onChange:function(a){e.onVideoInputChange(a,t,"video")},multiple:!0}),a.type.value&&Object.keys(a.type.value).map((function(e,t){return m.a.createElement("p",{style:{marginBottom:"0rem"},key:t},a.type.value[e].name)})))),m.a.createElement(v.a,{md:3},m.a.createElement(b.a,null,m.a.createElement(E.a,null,m.a.createElement(D.a,{content:"video preview"})," "),m.a.createElement("label",{for:"file-upload-preview"+t,style:{marginLeft:"5px"},className:"custom-file-upload"},m.a.createElement("i",{className:"text-info fa fa-cloud-upload"}),a.preview&&a.preview.length>0?m.a.createElement("p",{className:"preview-file"},a.preview[0].name):m.a.createElement(D.a,{content:"choose file"})),m.a.createElement("input",{type:"file",id:"file-upload-preview"+t,name:"file"+t,accept:"image/*",onChange:function(a){e.onVideoInputChange(a,t,"preview")}}))),m.a.createElement(v.a,{md:2,style:{display:"flex",justifyContent:"center",alignItems:"center"}},m.a.createElement("div",{className:"text-center"},m.a.createElement("i",{style:{fontSize:"15px"},className:"fa fa-close circle-icon-close",onClick:function(){return e.removeInputs(t)}}),"\xa0\xa0",m.a.createElement("i",{style:{fontSize:"15px"},className:"fa fa-plus circle-icon",onClick:e.addVideoDumyyItem})))))})),t?m.a.createElement("i",{className:"fa fa-spin fa-refresh authentication-loading",style:{float:"right"}}):m.a.createElement(y.a,{style:{float:"right"},className:" btn btn-primary mt-3",color:"primary",type:"submit",disabled:!this.isFormValid()},this.state.updateAlbum?m.a.createElement("span",{className:"text-white"},m.a.createElement(D.a,{content:"update"})):m.a.createElement("span",{className:"text-white"},m.a.createElement(D.a,{content:"publish"}))))))))))))}}]),t}(m.a.Component);a.default=Object(x.b)((function(e){return{config:e.auth.config}}),(function(e){return{}}))(I)}}]);
//# sourceMappingURL=6.dc11e203.chunk.js.map